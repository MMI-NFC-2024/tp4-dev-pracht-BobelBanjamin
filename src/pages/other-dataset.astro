---
import PlotFigure from "../components/PlotFigure.astro";
import Layout from "../layouts/Layout.astro";
import * as Plot from "@observablehq/plot";
import penguins from "../assets/penguins.json";
import "../styles/global.css";
---

<Layout>
    <div
        class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"
    >
        <div class="container mx-auto px-4 py-8">
            <!-- Navigation -->
            <nav
                class="mb-8 bg-white/80 backdrop-blur-sm rounded-full px-6 py-3 shadow-lg"
            >
                <div class="flex items-center justify-between">
                    <a
                        href="/"
                        class="text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2"
                    >
                        <svg
                            class="w-5 h-5"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        Accueil
                    </a>
                    <div class="flex gap-4 text-sm">
                        <a
                            href="/simple"
                            class="text-gray-600 hover:text-gray-900 transition-colors"
                            >Simple</a
                        >
                        <a
                            href="/simple-penguin"
                            class="text-gray-600 hover:text-gray-900 transition-colors"
                            >Simple Penguin</a
                        >
                        <a
                            href="/penguin-filter"
                            class="text-gray-600 hover:text-gray-900 transition-colors"
                            >Filtre</a
                        >
                        <a
                            href="/penguin-multi-filter"
                            class="text-gray-600 hover:text-gray-900 transition-colors"
                            >Multi-filtres</a
                        >
                        <a
                            href="/other-dataset"
                            class="text-gray-900 font-bold border-b-2 border-purple-600 pb-1"
                            >Iris</a
                        >
                    </div>
                </div>
            </nav>

            <!-- Header -->
            <div class="text-center mb-8">
                <h1
                    class="text-4xl font-bold mb-3 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent"
                >
                    Dataset Iris avec filtres
                </h1>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    Visualisez le c√©l√®bre dataset Iris et comparez les mesures
                    de s√©pales et p√©tales selon l‚Äôesp√®ce.
                </p>
            </div>

            <!-- Filtres -->
            <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Esp√®ce -->
                    <div>
                        <label
                            for="irisSpecies"
                            class="block text-sm font-medium text-gray-700"
                            >Esp√®ce</label
                        >
                        <select
                            id="irisSpecies"
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300
              focus:outline-none focus:ring-purple-500 focus:border-purple-500 rounded-lg"
                        >
                            <option value="">Toutes les esp√®ces</option>
                            <option value="setosa">üå∏ Setosa</option>
                            <option value="versicolor">üå∏ Versicolor</option>
                            <option value="virginica">üå∏ Virginica</option>
                        </select>
                    </div>

                    <!-- Axe X -->
                    <div>
                        <label
                            for="xAxis"
                            class="block text-sm font-medium text-gray-700"
                            >Axe X</label
                        >
                        <select
                            id="xAxis"
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300
              focus:outline-none focus:ring-purple-500 focus:border-purple-500 rounded-lg"
                        >
                            <option value="sepalLength">Sepal Length</option>
                            <option value="sepalWidth">Sepal Width</option>
                            <option value="petalLength">Petal Length</option>
                            <option value="petalWidth">Petal Width</option>
                        </select>
                    </div>

                    <!-- Axe Y -->
                    <div>
                        <label
                            for="yAxis"
                            class="block text-sm font-medium text-gray-700"
                            >Axe Y</label
                        >
                        <select
                            id="yAxis"
                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300
              focus:outline-none focus:ring-purple-500 focus:border-purple-500 rounded-lg"
                        >
                            <option value="sepalWidth">Sepal Width</option>
                            <option value="sepalLength">Sepal Length</option>
                            <option value="petalLength">Petal Length</option>
                            <option value="petalWidth">Petal Width</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Graphique -->
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <div id="plotContainer" class="flex justify-center"></div>
            </div>
        </div>
    </div>

    <div id="plotContainer"></div>

    <script>
        import * as Plot from "@observablehq/plot";

        // Dataset Iris simplifi√©
        const irisData = [
            {
                species: "setosa",
                sepalLength: 5.1,
                sepalWidth: 3.5,
                petalLength: 1.4,
                petalWidth: 0.2,
            },
            {
                species: "setosa",
                sepalLength: 4.9,
                sepalWidth: 3.0,
                petalLength: 1.4,
                petalWidth: 0.2,
            },
            {
                species: "setosa",
                sepalLength: 4.7,
                sepalWidth: 3.2,
                petalLength: 1.3,
                petalWidth: 0.2,
            },
            {
                species: "setosa",
                sepalLength: 4.6,
                sepalWidth: 3.1,
                petalLength: 1.5,
                petalWidth: 0.2,
            },
            {
                species: "setosa",
                sepalLength: 5.0,
                sepalWidth: 3.6,
                petalLength: 1.4,
                petalWidth: 0.2,
            },
            {
                species: "setosa",
                sepalLength: 5.4,
                sepalWidth: 3.9,
                petalLength: 1.7,
                petalWidth: 0.4,
            },
            {
                species: "setosa",
                sepalLength: 4.6,
                sepalWidth: 3.4,
                petalLength: 1.4,
                petalWidth: 0.3,
            },
            {
                species: "setosa",
                sepalLength: 5.0,
                sepalWidth: 3.4,
                petalLength: 1.5,
                petalWidth: 0.2,
            },
            {
                species: "setosa",
                sepalLength: 4.4,
                sepalWidth: 2.9,
                petalLength: 1.4,
                petalWidth: 0.2,
            },
            {
                species: "setosa",
                sepalLength: 4.9,
                sepalWidth: 3.1,
                petalLength: 1.5,
                petalWidth: 0.1,
            },
            {
                species: "versicolor",
                sepalLength: 7.0,
                sepalWidth: 3.2,
                petalLength: 4.7,
                petalWidth: 1.4,
            },
            {
                species: "versicolor",
                sepalLength: 6.4,
                sepalWidth: 3.2,
                petalLength: 4.5,
                petalWidth: 1.5,
            },
            {
                species: "versicolor",
                sepalLength: 6.9,
                sepalWidth: 3.1,
                petalLength: 4.9,
                petalWidth: 1.5,
            },
            {
                species: "versicolor",
                sepalLength: 5.5,
                sepalWidth: 2.3,
                petalLength: 4.0,
                petalWidth: 1.3,
            },
            {
                species: "versicolor",
                sepalLength: 6.5,
                sepalWidth: 2.8,
                petalLength: 4.6,
                petalWidth: 1.5,
            },
            {
                species: "versicolor",
                sepalLength: 5.7,
                sepalWidth: 2.8,
                petalLength: 4.5,
                petalWidth: 1.3,
            },
            {
                species: "versicolor",
                sepalLength: 6.3,
                sepalWidth: 3.3,
                petalLength: 4.7,
                petalWidth: 1.6,
            },
            {
                species: "versicolor",
                sepalLength: 4.9,
                sepalWidth: 2.4,
                petalLength: 3.3,
                petalWidth: 1.0,
            },
            {
                species: "versicolor",
                sepalLength: 6.6,
                sepalWidth: 2.9,
                petalLength: 4.6,
                petalWidth: 1.3,
            },
            {
                species: "versicolor",
                sepalLength: 5.2,
                sepalWidth: 2.7,
                petalLength: 3.9,
                petalWidth: 1.4,
            },
            {
                species: "virginica",
                sepalLength: 6.3,
                sepalWidth: 3.3,
                petalLength: 6.0,
                petalWidth: 2.5,
            },
            {
                species: "virginica",
                sepalLength: 5.8,
                sepalWidth: 2.7,
                petalLength: 5.1,
                petalWidth: 1.9,
            },
            {
                species: "virginica",
                sepalLength: 7.1,
                sepalWidth: 3.0,
                petalLength: 5.9,
                petalWidth: 2.1,
            },
            {
                species: "virginica",
                sepalLength: 6.3,
                sepalWidth: 2.9,
                petalLength: 5.6,
                petalWidth: 1.8,
            },
            {
                species: "virginica",
                sepalLength: 6.5,
                sepalWidth: 3.0,
                petalLength: 5.8,
                petalWidth: 2.2,
            },
            {
                species: "virginica",
                sepalLength: 7.6,
                sepalWidth: 3.0,
                petalLength: 6.6,
                petalWidth: 2.1,
            },
            {
                species: "virginica",
                sepalLength: 4.9,
                sepalWidth: 2.5,
                petalLength: 4.5,
                petalWidth: 1.7,
            },
            {
                species: "virginica",
                sepalLength: 7.3,
                sepalWidth: 2.9,
                petalLength: 6.3,
                petalWidth: 1.8,
            },
            {
                species: "virginica",
                sepalLength: 6.7,
                sepalWidth: 2.5,
                petalLength: 5.8,
                petalWidth: 1.8,
            },
            {
                species: "virginica",
                sepalLength: 7.2,
                sepalWidth: 3.6,
                petalLength: 6.1,
                petalWidth: 2.5,
            },
        ];

        const selectSpecies = document.querySelector("#irisSpecies");
        const selectXAxis = document.querySelector("#xAxis");
        const selectYAxis = document.querySelector("#yAxis");

        function renderPlot() {
            const species = selectSpecies.value;
            const xAxis = selectXAxis.value;
            const yAxis = selectYAxis.value;

            const container = document.querySelector("#plotContainer");
            container.innerHTML = "";

            const filteredData = species
                ? irisData.filter((d) => d.species === species)
                : irisData;

            const plot = Plot.plot({
                marks: [
                    Plot.dot(filteredData, {
                        x: xAxis,
                        y: yAxis,
                        stroke: "species",
                        r: 5,
                        tip: true,
                    }),
                ],
                grid: true,
                x: { label: `${xAxis} ‚Üí` },
                y: { label: `‚Üë ${yAxis}` },
                color: { legend: true },
            });

            container.append(plot);
        }

        selectSpecies.addEventListener("change", renderPlot);
        selectXAxis.addEventListener("change", renderPlot);
        selectYAxis.addEventListener("change", renderPlot);

        renderPlot();
    </script>
</Layout>
